<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Eye Visualization</title>
    <!-- Bulma Style Sheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bulma-extensions@6.2.7/dist/js/bulma-extensions.min.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <!-- D3 Visualization Javascript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- specific plugin -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- specific plugin -->
    <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
    <!-- data -->
    <script type="text/javascript" src="./Data/p6GZD.js"></script>
    <script type="text/javascript" src="./Data/p6graphGZD.js"></script>
    <!-- <script type="text/javascript" src="./Data/p6treeGZD.js"></script>
    <script type="text/javascript" src="./Data/p6graphFXD.js"></script>
    <script type="text/javascript" src="./Data/p6treeFXD.js"></script>
    <script type="text/javascript" src="./Data/p6graphEVD.js"></script>
    <script type="text/javascript" src="./Data/p6treeEVD.js"></script> -->
</head>

<body>
    <!-- Modal Summary Code -->
    <div id="summary_modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Summary</p>
                <button class="delete" aria-label="close"></button>
            </header>
            <section class="modal-card-body">
                <!-- Content ... -->
            </section>
        </div>
    </div>

    <div class="columns">
        <!-- This section is the context menu html -->
        <div class="column is-2">
            <div class="context-menu hero is-fullheight">
                <aside class="menu">
                    <p class="menu-label">
                        Eye Tracking Visualization
                    </p>
                    <ul class="menu-list">
                        <li><a onclick="load('baseline')">Base Line</a></li>
                        <li><a onclick="load('graph')">Graph</a></li>
                        <li><a onclick="load('tree')">Tree</a></li>
                    </ul>
                </aside>
            </div>
        </div>
        <!-- End of context menu html -->

        <!-- Start of Visualization Code -->
        <div class="column is-7">
            <div id="current_visualization" class="title">Baseline Visualization</div>
            <!-- Baseline D3 Visualization -->
            <div id="baseline" class="start top-spacing">
                <div id="container">
                    <div id="baseline_visualization"></div>
                    <img src="https://render.fineartamerica.com/images/rendered/default/print/8.000/5.375/break/images-medium-5/computer-monitor-vector-icon-bdcreations.jpg"
                        id="monitor" width="80%" />
                </div>

                <div class="container-spacing">
                    <input type="range" min="1" max="100" value="0" class="slider" id="timeline" width="80%">
                </div>

                <div class="has-text-centered container-spacing">
                    <a class="button media_button" onclick="moveFrame(-1)"><i id="previous_icon"
                            class="fa fa-angle-double-left"></i></a>
                    <a class="button large-media_button" onclick="play()"><i id="playericon"
                            class="fas fa-play"></i></a>
                    <a class="button media_button" onclick="moveFrame(1)"><i id="next_icon"
                            class="fa fa-angle-double-right"></i></a>

                </div>
            </div>
            <!-- Graph D3 Visualization -->
            <div id="graph" class="default">
                Graph
                <div id="graphviz"></div>
            </div>
            <!-- Tree D3 Visualization -->
            <div id="tree" class="default">
                Tree
                <div id="treeviz"></div>
            </div>
        </div>
        <!-- End of Visualization Code -->
        <!-- Start of Pupil Dialation -->
        <div class="column is-3">
            <div id="left_eye_container" class="eye box has-text-centered">
                <p class="title">Left Eye</p>
                <p id="left_pupil_size" class="subtitle">Pupil Size: 0 mm</p>
                <canvas id="left_pupils" class="canvas"></canvas>
            </div>
            <div id="right_eye_container" class="eye box has-text-centered">
                <p class="title">Right Eye</p>
                <p id="right_pupil_size" class="subtitle">Pupil Size: 0mm</p>
                <canvas id="right_pupils" class="canvas"></canvas>
            </div>
        </div>
    </div>
    <!-- Embedded Javascript for Pupils -->
    <script>
        const left = "left";
        const right = "right";

        function changePupil(side, value) {
            var container = document.getElementById(side + '_eye_container');
            var pupil_size = document.getElementById(side + "_pupil_size");
            // Resetting value
            document.getElementById(side + "_pupils").remove();
            var svgContainer = document.createElement("CANVAS");
            svgContainer.id = side + "_pupils"
            container.appendChild(svgContainer);
            var canvas = document.getElementById(side + '_pupils');
            // Get canvas dimensions
            var ctx = canvas.getContext('2d');
            var startX = (canvas.width / 2) - 20;
            var startY = (canvas.height / 2);
            var startAngle = 0;
            var endAngle = 180;
            var radius = value * 4;
            // Drawing Eyelid
            ctx.save();
            ctx.beginPath();
            ctx.ellipse(startX, startY, 75, 30, 0, startAngle, endAngle, 0);
            ctx.stroke();
            ctx.closePath();
            ctx.restore();
            // Drawing the Iris
            ctx.save();
            ctx.beginPath();
            ctx.fillStyle = side===left?'#FF0000':'#00FF00';
            ctx.arc(startX, startY, 26, startAngle, endAngle, 0);
            ctx.fill();
            ctx.closePath();
            ctx.restore();
            // Drawing Pupil
            if (radius > 0) {
                ctx.beginPath();
                ctx.arc(startX, startY, radius, startAngle, endAngle, 0);
                ctx.fill();
            }
            pupil_size.innerHTML = "Pupil Size: " + value + "mm";
        }
    </script>
    <!-- Embedded Javscript for the context menu-->
    <script>
        function load(id) {
            document.getElementById("baseline").style.display = "none";
            document.getElementById("graph").style.display = "none";
            document.getElementById("tree").style.display = "none";
            document.getElementById(id).style.display = "block";
            document.getElementById("current_visualization").innerHTML = id.replace(/^\w/, c => c.toUpperCase()) +
                " Visualization"
        }
    </script>
    <!-- Embedded Javascript for Modal Summary -->
    <script>
        // NOTHING YET HOLD YOUR HORSES PEOPLE
    </script>

    <!-- Embedded Javascript for Baseline visualization-->
    <script>
        var slider = document.getElementById("timeline");
        var monitor = document.getElementById("monitor");
        var container = document.getElementById("container");
        var intervalHandler = undefined;
        // Setting slider to show 1 second per frame
        slider.max = baseline.length;

        var maxY = getGZDYMax();
        var maxX = getGZDXMax();
        var minX = getGZDXMin();
        var minY = getGZDYMin();

        function moveFrame(value) {
            if (intervalHandler !== undefined) {
                document.getElementById("playericon").innerHTML = "<i id='playericon' class='fas fa-play'></i>";
                clearInterval(intervalHandler);
                intervalHandler = undefined;
            }
            slider.value = parseInt(slider.value) + value;
            const percentage = 100 * (slider.value - slider.min) / (slider.max - slider.min);
            const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            slider.style.background = bg;
            d3.select("#baseline_visualization").remove();
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "baseline_visualization"
            container.appendChild(svgContainer)
            createSVG(slider.value - 1);
        }

        function play() {
            if (intervalHandler === undefined) {
                document.getElementById("playericon").innerHTML = "<i id='playericon' class='fas fa-pause'></i>";
                intervalHandler = window.setInterval(() => {
                    slider.value = parseInt(slider.value) + 1;
                    const percentage = 100 * (slider.value - slider.min) / (slider.max - slider.min);
                    const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
                    slider.style.background = bg;
                    d3.select("#baseline_visualization").remove();
                    var svgContainer = document.createElement("DIV");
                    svgContainer.id = "baseline_visualization"
                    container.appendChild(svgContainer)
                    createSVG(slider.value - 1);
                }, 500);
            } else {
                document.getElementById("playericon").innerHTML = "<i id='playericon' class='fas fa-play'></i>";
                clearInterval(intervalHandler);
                intervalHandler = undefined;
            }
        }
        slider.addEventListener('input', () => {
            d3.select("#baseline_visualization").remove();
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "baseline_visualization"
            container.appendChild(svgContainer)
            const percentage = 100 * (slider.value - slider.min) / (slider.max - slider.min);
            const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            slider.style.background = bg;
            createSVG(slider.value - 1);
        }, false);
        createSVG(slider.value - 1);

        // Defining Functions
        function createSVG(value) {
            // set the dimensions and margins of the graph
            var margin = {
                    top: 100,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = monitor.clientWidth,
                height = monitor.clientHeight - margin.top - margin.bottom;
            // append the svg object to the body of the page
            var svg = d3.select("#baseline_visualization")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
            // read data

            // Add X axis
            var x = d3.scaleLinear()
                .domain([minX, maxX])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + 0 + "," + (height - 15) + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([minY, maxY + 100])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));
            // Formatting data
            var plots = [];
            plots.push({
                x: parseInt(baseline[value].LeftScreenX, 10),
                y: parseInt(baseline[value].LeftScreenY, 10),
                color: '#FF0000'
            });
            plots.push({
                x: parseInt(baseline[value].RightScreenX, 10),
                y: parseInt(baseline[value].RightScreenY, 10),
                color: '#00FF00'
            });
            changePupil(right, baseline[value].RightPupil);
            changePupil(left, baseline[value].LeftPupil);
            // SVG Eye
            var eyeSVG =
                "M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z";
            // Define the div for the tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll(".eyes")
                .data(plots)
                .enter()
                .append('path')
                .attr("class", '.eyes')
                .attr("d", eyeSVG).on("mouseover", function (d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    var type = d.color==="#00FF00"? "Right Eye" : "Left Eye";
                    div.html("<div>"+type+"</div>")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
            .style("fill", function (d) {
                    return d.color;
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x)) + ',' + (y(d.y)) + ')';
                })
        }

        function getGZDYMax() {
            return baseline.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenY
                }
                return Math.max(p.LeftScreenY, p.RightScreenY, max);
            });
        }

        function getGZDXMax() {
            return baseline.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenX
                }
                return Math.max(p.LeftScreenX, p.RightScreenX, max);
            });
        }

        function getGZDXMin() {
            return baseline.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenX
                }
                return Math.min(p.LeftScreenX, p.RightScreenX, min);
            });
        }

        function getGZDYMin() {
            return baseline.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenY
                }
                return Math.min(p.LeftScreenY, p.RightScreenY, min);
            });
        }
    </script>



</body>

</html>



<style>
    /* Context Menu CSS */
    .context-menu {
        background-color: #2d2d2d;
        padding: 5% 5% 5% 5%;
    }

    .menu * {
        color: #ffffff !important;
    }

    .start {
        display: block;
    }

    .default {
        display: none;
    }

    .top-spacing {
        margin-top: 2%;
    }

    /* Slider CSS */
    .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 15px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #023F59;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #023F59;
        cursor: pointer;
    }

    .large-media_button {
        border-radius: 100%;
        font-size: 40px;
        margin-left: 10px;
        margin-right: 10px;
    }

    .media_button {
        border-radius: 100%;
        font-size: 25px;
        top: 20px;
    }

    /* D3 Example Visualization */
    .container-spacing {
        margin-top: 10px;
    }

    img {
        opacity: .5;
        margin: 10px 30px 30px 40px;
    }

    #baseline_visualization {
        position: absolute;
        top: 0;
    }

    /* Pupil Styling */
    .title {
        margin: 0;
    }

    .eye {
        margin: 10% 2% 0% 2%;
        position: relative;
        border-style: solid;
        border-width: 20px;
    }

    div.tooltip {
        position: absolute;
        text-align: center;
        width: 60px;
        height: 28px;
        padding: 2px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }
</style>
