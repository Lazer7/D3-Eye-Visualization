<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Eye Visualization</title>
    <!-- Bulma Style Sheet -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.2/css/bulma.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bulma-extensions@6.2.7/dist/js/bulma-extensions.min.js"></script>
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
        integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf" crossorigin="anonymous">

    <script defer src="https://use.fontawesome.com/releases/v5.3.1/js/all.js"></script>
    <!-- D3 Visualization Javascript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- specific plugin -->
    <script src="https://d3js.org/d3.v4.js"></script>

    <!-- specific plugin -->
    <script src="https://d3js.org/d3-hexbin.v0.2.min.js"></script>
    <!-- data -->
    <script type="text/javascript" src="./Data/p6GZD.js"></script>
    <script type="text/javascript" src="./Data/p6graphGZD.js"></script>
    <script type="text/javascript" src="./Data/p6graphFXD.js"></script>
    <script type="text/javascript" src="./Data/p6treeGZD.js"></script>
    <script type="text/javascript" src="./Data/p6treeFXD.js"></script>

    <!-- <script type="text/javascript" src="./Data/p6graphEVD.js"></script>
    <script type="text/javascript" src="./Data/p6treeEVD.js"></script> -->
</head>

<body>
    <!-- Modal Summary Code -->
    <div id="summary_modal" class="modal">
        <div class="modal-background"></div>
        <div class="modal-card">
            <header class="modal-card-head">
                <p class="modal-card-title">Summary</p>
                <button class="delete" aria-label="close" onclick="toggleSummary(false)"></button>
            </header>
            <section id="summary_holder" class="modal-card-body">
                <!-- Content ... -->
                <div id="summary_visualization"></div>
            </section>
        </div>
    </div>

    <div class="columns">
        <!-- This section is the context menu html -->
        <div class="column is-2">
            <div class="context-menu hero is-fullheight">
                <aside class="menu">
                    <p class="menu-label">
                        Eye Tracking Visualization
                    </p>
                    <ul class="menu-list">
                        <li><a onclick="load('baseline')">Base Line</a></li>
                        <li><a onclick="load('graph')">Graph</a></li>
                        <li><a onclick="load('tree')">Tree</a></li>
                    </ul>
                </aside>
            </div>
        </div>
        <!-- End of context menu html -->

        <!-- Start of Visualization Code -->
        <div class="column is-7">
            <div id="current_visualization" class="title">Baseline Visualization</div>
            <!-- Baseline D3 Visualization -->
            <div id="baseline" class="start top-spacing">
                <div id="baseline_container">
                    <img id="baseline_monitor" src="./Assets/monitor.png" width="80%" />
                    <div id="baseline_visualization"></div>
                </div>

                <div class="container-spacing">
                    <input id="baseline_timeline" type="range" min="1" max="100" value="0" class="slider" width="80%">
                </div>
                <div class="columns">
                    <div class="column is-2"></div>
                    <div class="column has-text-centered container-spacing">
                        <a class="button media_button" onclick="moveFrameBaseline(-1)"><i id="previous_icon"
                                class="fa fa-angle-double-left"></i></a>
                        <a class="button large-media_button" onclick="playBaseline()"><i id="playericon"
                                class="fas fa-play"></i></a>
                        <a class="button media_button" onclick="moveFrameBaseline(1)"><i id="next_icon"
                                class="fa fa-angle-double-right"></i></a>
                    </div>
                    <div class="column is-2">
                        <a class="button has-text-right container-spacing" onclick="toggleSummary(true,'baseline')">
                            Show Summary
                        </a>
                    </div>
                </div>

            </div>
            <!-- Graph D3 Visualization -->
            <div id="graph" class="default">
                <div id="container2">
                    <img id="monitor2" src="./Assets/monitor.png" width="80%" />
                    <div id="graph_visualization"></div>
                </div>

                <div class="container-spacing">
                    <input id="timeline2" type="range" min="1" max="100" value="0" class="slider" width="80%">
                </div>
                <div class="columns">
                    <div class="column is-2"></div>
                    <div class="column has-text-centered container-spacing">
                        <a class="button media_button" onclick="moveFrame2(-1)">
                            <i id="previous_icon2" class="fa fa-angle-double-left"></i></a>
                        <a class="button large-media_button" onclick="play2()">
                            <i id="playericon2" class="fas fa-play"></i></a>
                        <a class="button media_button" onclick="moveFrame2(1)">
                            <i id="next_icon2" class="fa fa-angle-double-right"></i></a>
                    </div>
                    <div class="column is-2">
                        <a class="button has-text-right container-spacing" onclick="toggleSummary(true,'graph')">
                            Show Summary
                        </a>
                    </div>

                  </div>
            </div>

            <!-- Tree D3 Visualization -->
            <div id="tree" class="default">
                <div id="tree_container">
                    <img id="tree_monitor" src="./Assets/monitor.png" width="80%" />
                    <div id="tree_visualization"></div>
                </div>

                <div class="container-spacing">
                    <input id="tree_timeline" type="range" min="1" max="100" value="0" class="slider" width="80%">
                </div>
                <div class="columns">
                    <div class="column is-2"></div>
                    <div class="column has-text-centered container-spacing">
                        <a class="button media_button" onclick="moveFrameTree(-1)">
                            <i id="previous_icon_tree" class="fa fa-angle-double-left"></i></a>
                        <a class="button large-media_button" onclick="playTree()">
                            <i id="playericon_tree" class="fas fa-play"></i></a>
                        <a class="button media_button" onclick="moveFrameTree(1)">
                            <i id="next_icon_tree" class="fa fa-angle-double-right"></i></a>
                    </div>
                    <div class="column is-2">
                        <a class="button has-text-right container-spacing" onclick="toggleSummary(true,'tree')">
                            Show Summary
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <!-- End of Visualization Code -->
        <!-- Start of Pupil Dialation -->
        <div id="dialation_container" class="column is-3">
            <div id="left_eye_container" class="eye box has-text-centered">
                <p class="title">Left Eye</p>
                <p id="left_pupil_size" class="subtitle">Pupil Size: 0 mm</p>
                <canvas id="left_pupils" class="canvas"></canvas>
            </div>
            <div id="right_eye_container" class="eye box has-text-centered">
                <p class="title">Right Eye</p>
                <p id="right_pupil_size" class="subtitle">Pupil Size: 0mm</p>
                <canvas id="right_pupils" class="canvas"></canvas>
            </div>
        </div>
    </div>
    <!-- Embedded Javascript for Pupils -->
    <script>
        const left = "left";
        const right = "right";

        function changePupil(side, value) {
            var container = document.getElementById(side + '_eye_container');
            var pupil_size = document.getElementById(side + "_pupil_size");
            // Resetting value
            document.getElementById(side + "_pupils").remove();
            var svgContainer = document.createElement("CANVAS");
            svgContainer.id = side + "_pupils"
            container.appendChild(svgContainer);
            var canvas = document.getElementById(side + '_pupils');
            // Get canvas dimensions
            var ctx = canvas.getContext('2d');
            var startX = (canvas.width / 2) - 20;
            var startY = (canvas.height / 2);
            var startAngle = 0;
            var endAngle = 180;
            var radius = value * 4;
            // Drawing Eyelid
            ctx.save();
            ctx.beginPath();
            ctx.ellipse(startX, startY, 75, 30, 0, startAngle, endAngle, 0);
            ctx.stroke();
            ctx.closePath();
            ctx.restore();
            // Drawing the Iris
            ctx.save();
            ctx.beginPath();
            ctx.fillStyle = side === left ? '#FF0000' : '#00FF00';
            ctx.arc(startX, startY, 26, startAngle, endAngle, 0);
            ctx.fill();
            ctx.closePath();
            ctx.restore();
            // Drawing Pupil
            if (radius > 0) {
                ctx.beginPath();
                ctx.arc(startX, startY, radius, startAngle, endAngle, 0);
                ctx.fill();
            }
            pupil_size.innerHTML = "Pupil Size: " + value + "mm";
        }
    </script>
    <!-- Embedded Javscript for the context menu-->
    <script>
        function load(id) {
            document.getElementById("baseline").style.display = "none";
            document.getElementById("graph").style.display = "none";
            document.getElementById("tree").style.display = "none";
            document.getElementById(id).style.display = "block";
            document.getElementById("current_visualization").innerHTML = id.replace(/^\w/, c => c.toUpperCase()) +
                " Visualization"
        }
    </script>
    <!-- Embedded Javascript for Baseline visualization-->
    <script>
        var baselineslider = document.getElementById("baseline_timeline");
        var baselinemonitor = document.getElementById("baseline_monitor");
        var baselinecontainer = document.getElementById("baseline_container");
        var baselineintervalHandler = undefined;
        // SVG Eye
        var eyeSVG =
            "M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z";
        // Setting slider to show 1 second per frame
        baselineslider.max = baseline.length;

        var maxBaseY = getBaseGZDYMax();
        var maxBaseX = getBaseGZDXMax();
        var minBaseX = getBaseGZDXMin();
        var minBaseY = getBaseGZDYMin();


        baselineslider.addEventListener('input', () => {
            d3.select("#baseline_visualization").remove();
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "baseline_visualization"
            baselinecontainer.appendChild(svgContainer)
            const percentage = 100 * (baselineslider.value - baselineslider.min) / (baselineslider.max -
                baselineslider.min);
            const bg = `linear-gradient(90deg, #50806a ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            baselineslider.style.background = bg;
            createBaselineSVG(baselineslider.value - 1);
        }, false);
        createBaselineSVG(baselineslider.value - 1);

        function createBaselineSVG(value) {
            // set the dimensions and margins of the graph
            var margin = {
                    top: 100,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = baselinemonitor.clientWidth,
                height = baselinemonitor.clientHeight - margin.top - margin.bottom;
            // append the svg object to the body of the page
            var svg = d3.select("#baseline_visualization")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
            // read data

            // Add X axis
            var x = d3.scaleLinear()
                .domain([minBaseX, maxBaseX])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + 0 + "," + (height - 15) + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([minBaseY, maxBaseY + 100])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));
            // Formatting data
            var plots = [];
            plots.push({
                x: parseInt(baseline[value].LeftScreenX, 10),
                y: parseInt(baseline[value].LeftScreenY, 10),
                color: '#FF0000'
            });
            plots.push({
                x: parseInt(baseline[value].RightScreenX, 10),
                y: parseInt(baseline[value].RightScreenY, 10),
                color: '#00FF00'
            });
            changePupil(right, baseline[value].RightPupil);
            changePupil(left, baseline[value].LeftPupil);

            // Define the div for the tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltipbaseline")
                .style("opacity", 0);

            svg.selectAll(".eyes")
                .data(plots)
                .enter()
                .append('path')
                .attr("class", '.eyes')
                .attr("d", eyeSVG).on("mouseover", function (d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    var type = d.color === "#00FF00" ? "Right Eye" : "Left Eye";
                    div.html("<div>" + type + "</div>" +
                            "<div>X: " + d.x + "</div>" +
                            "<div>Y: " + d.y + "</div>")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .style("fill", function (d) {
                    return d.color;
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x)) + ',' + (y(d.y)) + ')';
                })

            d3.selectAll("text").attr("fill", "#FFFFFF")
                .attr("font-weight", "bold")
                .attr("opacity", "1.0");
        }

        function moveFrameBaseline(value) {
            if (baselineintervalHandler !== undefined) {
                document.getElementById("playericon").innerHTML = "<i id='playericon' class='fas fa-play'></i>";
                clearInterval(baselineintervalHandler);
                baselineintervalHandler = undefined;
            }
            baselineslider.value = parseInt(baselineslider.value) + value;
            const percentage = 100 * (baselineslider.value - baselineslider.min) / (baselineslider.max - baselineslider
                .min);
            const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            baselineslider.style.background = bg;
            d3.select("#baseline_visualization").remove();
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "baseline_visualization"
            baselinecontainer.appendChild(svgContainer)
            createBaselineSVG(baselineslider.value - 1);
        }

        function playBaseline() {
            if (baselineintervalHandler === undefined) {
                document.getElementById("playericon").innerHTML = "<i id='playericon' class='fas fa-pause'></i>";
                baselineintervalHandler = window.setInterval(() => {
                    baselineslider.value = parseInt(baselineslider.value) + 1;
                    const percentage = 100 * (baselineslider.value - baselineslider.min) / (baselineslider.max -
                        baselineslider.min);
                    const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
                    baselineslider.style.background = bg;
                    d3.select("#baseline_visualization").remove();
                    var svgContainer = document.createElement("DIV");
                    svgContainer.id = "baseline_visualization"
                    baselinecontainer.appendChild(svgContainer)
                    createBaselineSVG(baselineslider.value - 1);
                }, 500);
            } else {
                document.getElementById("playericon").innerHTML = "<i id='playericon' class='fas fa-play'></i>";
                clearInterval(baselineintervalHandler);
                baselineintervalHandler = undefined;
            }
        }

        function getBaseGZDYMax() {
            return baseline.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenY
                }
                return Math.max(p.LeftScreenY, p.RightScreenY, max);
            });
        }

        function getBaseGZDXMax() {
            return baseline.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenX
                }
                return Math.max(p.LeftScreenX, p.RightScreenX, max);
            });
        }

        function getBaseGZDXMin() {
            return baseline.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenX
                }
                return Math.min(p.LeftScreenX, p.RightScreenX, min);
            });
        }

        function getBaseGZDYMin() {
            return baseline.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenY
                }
                return Math.min(p.LeftScreenY, p.RightScreenY, min);
            });
        }
    </script>


    <!--script for graph visualization-->
    <script>
        var slider2 = document.getElementById("timeline2");
        var monitor2 = document.getElementById("monitor2");
        var container2 = document.getElementById("container2");
        var intervalHandler2 = undefined;

        // SVG Eye
        var eyeSVG =
            "M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z";
        var fxdSVG =
            "M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm.053 17c.466 0 .844-.378.844-.845 0-.466-.378-.844-.844-.844-.466 0-.845.378-.845.844 0 .467.379.845.845.845zm.468-2.822h-.998c-.035-1.162.182-2.054.939-2.943.491-.57 1.607-1.479 1.945-2.058.722-1.229.077-3.177-2.271-3.177-1.439 0-2.615.877-2.928 2.507l-1.018-.102c.28-2.236 1.958-3.405 3.922-3.405 1.964 0 3.615 1.25 3.615 3.22 0 1.806-1.826 2.782-2.638 3.868-.422.563-.555 1.377-.568 2.09z";
        // Setting slider to show 1 second per frame
        slider2.max = graphGZD.length;

        var maxY2 = getGZDYMax2();
        var maxX2 = getGZDXMax2();
        var minX2 = getGZDXMin2();
        var minY2 = getGZDYMin2();

        slider2.addEventListener('input', () => {
            d3.select("#graph_visualization").remove();
            var svgContainer2 = document.createElement("DIV");
            svgContainer2.id = "graph_visualization"
            container2.appendChild(svgContainer2)
            const percentage = 100 * (slider2.value - slider2.min) / (slider2.max - slider2.min);
            const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            slider2.style.background = bg;
            createSVG2(slider2.value - 1);
        }, false);
        createSVG2(slider2.value - 1);



        // Defining Functions
        function createSVG2(value) {
            // set the dimensions and margins of the graph
            var margin = {
                    top: 100,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = monitor2.clientWidth,
                height = monitor2.clientHeight - margin.top - margin.bottom;
            // append the svg object to the body of the page
            var svg = d3.select("#graph_visualization")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
            // read data

            // Add X axis
            var x = d3.scaleLinear()
                .domain([minX2, maxX2])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + (-75) + "," + (height - 15) + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([minY2, maxY2 + 100])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));

            // Formatting data
            var currentGraphFXD = graphFXD[value];
            var fxd = [];
            var graphPlots = [];
            var lastGZD = {};
            if (value === 0) {
                fxd.push({
                    x: parseInt(currentGraphFXD.ScreenX, 10),
                    y: parseInt(currentGraphFXD.ScreenY, 10)
                })
                graphGZD.forEach(element => {
                    if ((currentGraphFXD.Time - 0) < (element.Time - 0)) {
                        return;
                    } else {
                        graphPlots.push({
                            x: parseInt(element.LeftScreenX, 10),
                            y: parseInt(element.LeftScreenY, 10),
                            color: '#FF0000'
                        });
                        graphPlots.push({
                            x: parseInt(element.RightScreenX, 10),
                            y: parseInt(element.RightScreenY, 10),
                            color: '#00FF00'
                        });
                        lastGZD =element;
                    }
                })
            } else {
                var startpointGraph = (value - 4) < 0 ? 0 : value - 4;
                for (startpointGraph; startpointGraph < value + 1; startpointGraph++) {
                    fxd.push({
                        x: parseInt(graphFXD[startpointGraph].ScreenX, 10),
                        y: parseInt(graphFXD[startpointGraph].ScreenY, 10)
                    });
                }
                startpointGraph = (value - 4) < 0 ? 0 : value - 4;
                graphGZD.forEach(element => {
                    if ((currentGraphFXD.Time - 0) < (element.Time - 0)) {
                        return;
                    }
                    if ((graphFXD[startpointGraph].Time - 0) < (element.Time - 0)) {
                        graphPlots.push({
                            x: parseInt(element.LeftScreenX, 10),
                            y: parseInt(element.LeftScreenY, 10),
                            color: '#FF0000'
                        });
                        graphPlots.push({
                            x: parseInt(element.RightScreenX, 10),
                            y: parseInt(element.RightScreenY, 10),
                            color: '#00FF00'
                        });
                        lastGZD = element
                    }
                })
            }

            changePupil(right, graphGZD[value].RightPupil);
            changePupil(left, graphGZD[value].LeftPupil);

            //sorting fixation Points
            fxd.sort((a,b)=>{
              return (a.x-b.x)+(a.y-b.y)
            })

            // Define the div for the tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltipgraph")
                .style("opacity", 0);

            svg.selectAll(".grapheyes")
                .data(graphPlots)
                .enter()
                .append('path')
                .attr("class", '.grapheyes')
                .attr("d", eyeSVG)
                .style("fill", function (d) {
                    return d.color;
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x)) + ',' + (y(d.y)) + ')';
                })

            //plot fixation data
            svg.selectAll(".fixed")
                .data(fxd)
                .enter()
                .append('path')
                .attr("class", '.fixed')
                .attr("d", fxdSVG)
                .style("fill", "#0000FF")
                .style("fill-rule","evenodd")
                .on("mouseover", function (d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html("<div>Fixation</div>" +
                            "<div> X: " + d.x + "</div>" +
                            "<div> Y: " + d.y + "</div>")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x - 25)) + ',' + (y(d.y + 30)) + ')';
                })

                d3.selectAll("text").attr("fill", "#FFFFFF")
                    .attr("font-weight", "bold")
                    .attr("opacity", "1.0");

                svg.selectAll("polygon")
                    .data([fxd])
                    .enter().append("polygon")
                    .attr("points", function (d) {
                        return d.map(function (d) {
                            return [x(d.x), y(d.y)].join(",");
                        }).join(" ");
                    });
        }

        function moveFrame2(value) {
            if (intervalHandler2 !== undefined) {
                document.getElementById("playericon2").innerHTML = "<i id='playericon2' class='fas fa-play'></i>";
                clearInterval(intervalHandler2);
                intervalHandler2 = undefined;
            }
            slider2.value = parseInt(slider2.value) + value;
            const percentage = 100 * (slider2.value - slider2.min) / (slider2.max - slider2.min);
            const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            slider2.style.background = bg;
            d3.select("#graph_visualization").remove();
            var svgContainer2 = document.createElement("DIV");
            svgContainer2.id = "graph_visualization"
            container2.appendChild(svgContainer2)
            createSVG2(slider2.value - 1);
        }

        function play2() {
            if (intervalHandler2 === undefined) {
                document.getElementById("playericon2").innerHTML = "<i id='playericon2' class='fas fa-pause'></i>";
                intervalHandler2 = window.setInterval(() => {
                    slider2.value = parseInt(slider2.value) + 1;
                    const percentage = 100 * (slider2.value - slider2.min) / (slider2.max - slider2.min);
                    const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
                    slider2.style.background = bg;
                    d3.select("#graph_visualization").remove();
                    var svgContainer2 = document.createElement("DIV");
                    svgContainer2.id = "graph_visualization"
                    container2.appendChild(svgContainer2)
                    createSVG2(slider2.value - 1);
                }, 500);
            } else {
                document.getElementById("playericon2").innerHTML = "<i id='playericon2' class='fas fa-play'></i>";
                clearInterval(intervalHandler2);
                intervalHandler2 = undefined;
            }
        }


        function getGZDYMax2() {
            return graphGZD.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenY
                }
                return Math.max(p.LeftScreenY, p.RightScreenY, max);
            });
        }

        function getGZDXMax2() {
            return graphGZD.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenX
                }
                return Math.max(p.LeftScreenX, p.RightScreenX, max);
            });
        }

        function getGZDXMin2() {
            return graphGZD.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenX
                }
                return Math.min(p.LeftScreenX, p.RightScreenX, min);
            });
        }

        function getGZDYMin2() {
            return graphGZD.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenY
                }
                return Math.min(p.LeftScreenY, p.RightScreenY, min);
            });
        }
    </script>

    <!-- Embedded Javascript for Tree visualization -->
    <script>
        var treeslider = document.getElementById("tree_timeline");
        var treemonitor = document.getElementById("tree_monitor");
        var treecontainer = document.getElementById("tree_container");
        var treeintervalHandler = undefined;
        // SVG Eye
        var eyeSVG =
            "M15 12c0 1.654-1.346 3-3 3s-3-1.346-3-3 1.346-3 3-3 3 1.346 3 3zm9-.449s-4.252 8.449-11.985 8.449c-7.18 0-12.015-8.449-12.015-8.449s4.446-7.551 12.015-7.551c7.694 0 11.985 7.551 11.985 7.551zm-7 .449c0-2.757-2.243-5-5-5s-5 2.243-5 5 2.243 5 5 5 5-2.243 5-5z";
        // Setting slider to show 1 second per frame
        treeslider.max = treeFXD.length;
        var maxTreeY = getTreeGZDYMax();
        var maxTreeX = getTreeGZDXMax();
        var minTreeX = getTreeGZDXMin();
        var minTreeY = getTreeGZDYMin();

        treeslider.addEventListener('input', () => {
            d3.select("#tree_visualization").remove();
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "tree_visualization"
            treecontainer.appendChild(svgContainer)
            const percentage = 100 * (treeslider.value - treeslider.min) / (treeslider.max - treeslider.min);
            const bg = `linear-gradient(90deg, #50806a ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            treeslider.style.background = bg;
            createTreeSVG(treeslider.value - 1);
        }, false);

        createTreeSVG(treeslider.value - 1);

        function createTreeSVG(value) {
            // set the dimensions and margins of the graph
            var margin = {
                    top: 100,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = treemonitor.clientWidth,
                height = treemonitor.clientHeight - margin.top - margin.bottom;
            // append the svg object to the body of the page
            var svg = d3.select("#tree_visualization")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");
            // read data

            // Add X axis
            var x = d3.scaleLinear()
                .domain([minTreeX, maxTreeX])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + (-75) + "," + (height - 15) + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([minTreeY, maxTreeY + 100])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));
            // Formatting data
            var currentFixation = treeFXD[value];
            var fixationPlots = [];
            var gazePlots = [];
            var lastGazePlot = {}
            if (value === 0) {
                fixationPlots.push({
                    x: parseInt(currentFixation.ScreenX, 10),
                    y: parseInt(currentFixation.ScreenY, 10)
                })
                treeGZD.forEach(element => {
                    if ((currentFixation.Time - 0) < (element.Time - 0)) {
                        return;
                    } else {
                        gazePlots.push({
                            x: parseInt(element.LeftScreenX, 10),
                            y: parseInt(element.LeftScreenY, 10),
                            color: '#FF0000'
                        });
                        gazePlots.push({
                            x: parseInt(element.RightScreenX, 10),
                            y: parseInt(element.RightScreenY, 10),
                            color: '#00FF00'
                        });
                        lastGazePlot =element;
                    }
                })
            } else {
                var startpoint = (value - 4) < 0 ? 0 : value - 4;
                for (startpoint; startpoint < value + 1; startpoint++) {
                    fixationPlots.push({
                        x: parseInt(treeFXD[startpoint].ScreenX, 10),
                        y: parseInt(treeFXD[startpoint].ScreenY, 10)
                    });
                }
                startpoint = (value - 4) < 0 ? 0 : value - 4;
                treeGZD.forEach(element => {
                    if ((currentFixation.Time - 0) < (element.Time - 0)) {
                        return;
                    }
                    if ((treeFXD[startpoint].Time - 0) < (element.Time - 0)) {
                        gazePlots.push({
                            x: parseInt(element.LeftScreenX, 10),
                            y: parseInt(element.LeftScreenY, 10),
                            color: '#FF0000'
                        });
                        gazePlots.push({
                            x: parseInt(element.RightScreenX, 10),
                            y: parseInt(element.RightScreenY, 10),
                            color: '#00FF00'
                        });
                        lastGazePlot = element
                    }
                })
            }
            changePupil(right, lastGazePlot.RightPupil);
            changePupil(left, lastGazePlot.LeftPupil);
            // Sorting Fixation Points
            fixationPlots.sort((a, b) => {
                return (a.x - b.x) + (a.y - b.y)
            })
            // Define the div for the tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltiptree")
                .style("opacity", 0);

            svg.selectAll(".treeeyes")
                .data(gazePlots)
                .enter()
                .append('path')
                .attr("class", '.treeeyes')
                .attr("d", eyeSVG)
                .style("fill", function (d) {
                    return d.color;
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x)) + ',' + (y(d.y)) + ')';
                })

            svg.selectAll(".fixedeyes")
                .data(fixationPlots)
                .enter()
                .append('path')
                .attr("class", '.fixedeyes')
                .attr("d", eyeSVG)
                .style("fill", "#F66A9")
                .on("mouseover", function (d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    div.html("<div>Fixation</div>" +
                            "<div> X: " + d.x + "</div>" +
                            "<div> Y: " + d.y + "</div>")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x - 25)) + ',' + (y(d.y + 30)) + ')';
                })

            d3.selectAll("text").attr("fill", "#FFFFFF")
                .attr("font-weight", "bold")
                .attr("opacity", "1.0");

            svg.selectAll("polygon")
                .data([fixationPlots])
                .enter().append("polygon")
                .attr("points", function (d) {
                    return d.map(function (d) {
                        return [x(d.x), y(d.y)].join(",");
                    }).join(" ");
                });
        }

        function moveFrameTree(value) {
            if (treeintervalHandler !== undefined) {
                document.getElementById("playericon_tree").innerHTML =
                    "<i id='playericon_tree' class='fas fa-play'></i>";
                clearInterval(treeintervalHandler);
                treeintervalHandler = undefined;
            }
            treeslider.value = parseInt(treeslider.value) + value;
            const percentage = 100 * (treeslider.value - treeslider.min) / (treeslider.max - treeslider.min);
            const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
            treeslider.style.background = bg;
            d3.select("#tree_visualization").remove();
            var svgContainer = document.createElement("DIV");
            svgContainer.id = "tree_visualization"
            treecontainer.appendChild(svgContainer)
            createTreeSVG(treeslider.value - 1);
        }

        function playTree() {
            if (treeintervalHandler === undefined) {
                document.getElementById("playericon_tree").innerHTML =
                    "<i id='playericon_tree' class='fas fa-pause'></i>";
                treeintervalHandler = window.setInterval(() => {
                    treeslider.value = parseInt(treeslider.value) + 1;
                    const percentage = 100 * (treeslider.value - treeslider.min) / (treeslider.max - treeslider
                        .min);
                    const bg = `linear-gradient(90deg, #3C97BF ${percentage}%, #d3d3d3 ${percentage+0.1}%)`;
                    treeslider.style.background = bg;
                    d3.select("#tree_visualization").remove();
                    var svgContainer = document.createElement("DIV");
                    svgContainer.id = "tree_visualization"
                    treecontainer.appendChild(svgContainer)
                    createTreeSVG(treeslider.value - 1);
                }, 500);
            } else {
                document.getElementById("playericon_tree").innerHTML =
                    "<i id='playericon_tree' class='fas fa-play'></i>";
                clearInterval(treeintervalHandler);
                treeintervalHandler = undefined;
            }
        }

        function getTreeGZDYMax() {
            return treeGZD.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenY
                }
                return Math.max(p.LeftScreenY, p.RightScreenY, max);
            });
        }

        function getTreeGZDXMax() {
            return treeGZD.reduce((max, p) => {
                if (max.constructor === ({}).constructor) {
                    max = max.LeftScreenX
                }
                return Math.max(p.LeftScreenX, p.RightScreenX, max);
            });
        }

        function getTreeGZDXMin() {
            return treeGZD.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenX
                }
                return Math.min(p.LeftScreenX, p.RightScreenX, min);
            });
        }

        function getTreeGZDYMin() {
            return treeGZD.reduce((min, p) => {
                if (min.constructor === ({}).constructor) {
                    min = min.LeftScreenY
                }
                return Math.min(p.LeftScreenY, p.RightScreenY, min);
            });
        }
    </script>



    <!-- Embedded Javascript for the Summary Screen -->
    <script>
        // Defining Functions
        function createBaselineSummary() {
            // set the dimensions and margins of the graph
            var margin = {
                    top: 10,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = 700,
                height = 500;
            // append the svg object to the body of the page
            var svg = d3.select("#summary_visualization")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var maxBaseY = getBaseGZDYMax();
            var maxBaseX = getBaseGZDXMax();
            var minBaseX = getBaseGZDXMin();
            var minBaseY = getBaseGZDYMin();
            // Add X axis
            var x = d3.scaleLinear()
                .domain([minBaseX, maxBaseX])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + 0 + "," + (height - 15) + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([minBaseY, maxBaseY + 100])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));
            // Formatting data
            var plots = [];
            baseline.forEach(element => {
                plots.push({
                    x: parseInt(element.LeftScreenX, 10),
                    y: parseInt(element.LeftScreenY, 10),
                    color: '#FF0000'
                })
                plots.push({
                    x: parseInt(element.RightScreenX, 10),
                    y: parseInt(element.RightScreenY, 10),
                    color: '#00FF00'
                });
            });

        var lineFunction = d3.svg.line()
            .x((d) => {
                return x(d.x);
            })
            .y((d) => {
                return y(d.y);
            })
            .interpolate("linear");

        // Define the div for the tooltip
        var div = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        svg.selectAll(".eyes")
            .data(plots)
            .enter()
            .append('path')
            .attr("class", '.eyes')
            .attr("d", eyeSVG).on("mouseover", function (d) {
                div.transition()
                    .duration(200)
                    .style("opacity", .9);
                var type = d.color === "#00FF00" ? "Right Eye" : "Left Eye";
                div.html("<div>" + type + "</div>")
                    .style("left", (d3.event.pageX) + "px")
                    .style("top", (d3.event.pageY - 28) + "px");
            })
            .on("mouseout", function (d) {
                div.transition()
                    .duration(500)
                    .style("opacity", 0);
            })
            .style("fill", function (d) {
                return d.color;
            })
            .attr("transform", function (d) {
                return 'translate(' + (x(d.x)) + ',' + (y(d.y)) + ')';
            });

        svg.append("path")
            .attr("d", lineFunction(plots))
            .attr("stroke", "blue")
            .attr("stroke-width", 1)
            .attr("fill", "none")

    }

        function createGraphSummary() {
            // set the dimensions and margins of the graph
            var margin = {
                    top: 10,
                    right: 0,
                    bottom: 35,
                    left: 62
                },
                width = 700,
                height = 500;

            var fxdSVG =
                 "M12 0c6.623 0 12 5.377 12 12s-5.377 12-12 12-12-5.377-12-12 5.377-12 12-12zm0 1c6.071 0 11 4.929 11 11s-4.929 11-11 11-11-4.929-11-11 4.929-11 11-11zm.053 17c.466 0 .844-.378.844-.845 0-.466-.378-.844-.844-.844-.466 0-.845.378-.845.844 0 .467.379.845.845.845zm.468-2.822h-.998c-.035-1.162.182-2.054.939-2.943.491-.57 1.607-1.479 1.945-2.058.722-1.229.077-3.177-2.271-3.177-1.439 0-2.615.877-2.928 2.507l-1.018-.102c.28-2.236 1.958-3.405 3.922-3.405 1.964 0 3.615 1.25 3.615 3.22 0 1.806-1.826 2.782-2.638 3.868-.422.563-.555 1.377-.568 2.09z";
            // append the svg object to the body of the page
            var svg = d3.select("#summary_visualization")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            // Add X axis
            var x = d3.scaleLinear()
                .domain([minX2, maxX2])
                .range([0, width]);
            svg.append("g")
                .attr("transform", "translate(" + 0 + "," + (height - 15) + ")")
                .call(d3.axisBottom(x));

            // Add Y axis
            var y = d3.scaleLinear()
                .domain([minY2, maxY2 + 100])
                .range([height, 0]);
            svg.append("g")
                .call(d3.axisLeft(y));
            // Formatting data
            var plots = [];
            graphFXD.forEach(element => {
                plots.push({
                    x: parseInt(element.ScreenX, 10),
                    y: parseInt(element.ScreenY, 10),
                    color: '#0000FF'
                })
            });

            var lineFunction = d3.svg.line()
                .x((d) => {
                    return x(d.x);
                })
                .y((d) => {
                    return y(d.y);
                })
                .interpolate("linear");

            // Define the div for the tooltip
            var div = d3.select("body").append("div")
                .attr("class", "tooltip")
                .style("opacity", 0);

            svg.selectAll(".fxd")
                .data(plots)
                .enter()
                .append('path')
                .attr("class", '.fxd')
                .attr("d", fxdSVG).on("mouseover", function (d) {
                    div.transition()
                        .duration(200)
                        .style("opacity", .9);
                    var type = d.color === "0000FF";
                    div.html("<div>" + type + "</div>")
                        .style("left", (d3.event.pageX) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    div.transition()
                        .duration(500)
                        .style("opacity", 0);
                })
                .style("fill", function (d) {
                    return d.color;
                })
                .attr("transform", function (d) {
                    return 'translate(' + (x(d.x)) + ',' + (y(d.y)) + ')';
                })
                .style("fill-rule", function(d){
                  return 'evenodd';
                });

            svg.append("path")
                .attr("d", lineFunction(plots))
                .attr("stroke", "blue")
                .attr("stroke-width", 1)
                .attr("fill", "none")

        }

        function toggleSummary(value, option) {
            var modal = document.getElementById("summary_modal");
            if (value) {
                modal.className = "modal is-active";
                switch (option) {
                    case "baseline":
                        createBaselineSummary();
                        break;
                    case "graph":
                        createGraphSummary();
                        break;
                    case "tree":
                        break;
                }
            } else {
                modal.className = "modal";
                d3.select("#summary_visualization").remove();
                var container = document.getElementById("summary_holder");
                var svgContainer = document.createElement("DIV");
                svgContainer.id = "summary_visualization";
                container.appendChild(svgContainer);
            }
        }
    </script>

</body>

</html>



<style>
    html {
        background-image: linear-gradient(#78bf9f, #d6deaf);
    }

    .columns {
        margin-bottom: 0 !important;
        padding-bottom: 0 !important;
    }

    /* Context Menu CSS */
    .context-menu {
        background-color: #2d2d2d;
        padding: 5% 5% 5% 5%;
    }

    .menu * {
        color: #ffffff !important;
    }

    .start {
        display: block;
    }

    .default {
        display: none;
    }

    .top-spacing {
        margin-top: 2%;
    }

    /* Slider CSS */
    .slider {
        -webkit-appearance: none;
        appearance: none;
        width: 100%;
        height: 15px;
        border-radius: 5px;
        background: #d3d3d3;
        outline: none;
        opacity: 0.7;
        -webkit-transition: .2s;
        transition: opacity .2s;
    }

    .slider::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #023F59;
        cursor: pointer;
    }

    .slider::-moz-range-thumb {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background: #023F59;
        cursor: pointer;
    }

    .fa-play,
    .fa-angle-double-right,
    .fa-angle-double-left {
        color: #FFFFFF;
    }

    .button {
        background-color: #50806a;
        color: white;
    }

    .large-media_button {
        border-radius: 100%;
        font-size: 40px;
        margin-left: 10px;
        margin-right: 10px;

    }

    .media_button {
        border-radius: 100%;
        font-size: 25px;
        top: 20px;

    }

    /* D3 Visualization */
    .container-spacing {
        margin-top: 10px;
    }

    img {
        opacity: .5;
        margin: 10px 30px 30px 40px;
    }

    #baseline_visualization,
    #graph_visualization,
    #tree_visualization {
        position: absolute;
        top: 0;
    }

    #graph_visualization {
        position: absolute;
        top: 0;
    }
    polygon {
        fill: CadetBlue;
        opacity: .5;
    }

    .title {
        margin: 0;
    }

    .eye {
        margin: 10% 2% 0% 2%;
        position: relative;
        border: 20px solid rgba(0, 0, 0, .75);
        background-color: rgba(0, 0, 0, 0)
    }

    div.tooltipbaseline,
    div.tooltiptree,
    div.tooltipgraph {
        position: absolute;
        text-align: center;
        width: 75px;
        height: 50px;
        padding: 2px;
        font: 12px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        pointer-events: none;
    }

    /* Modal Styling */
    .modal-card {
        width: 65% !important;
    }
</style>
